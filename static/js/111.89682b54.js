"use strict";(self["webpackChunkonepic"]=self["webpackChunkonepic"]||[]).push([[111],{49093:function(e,t,r){r.d(t,{V:function(){return a}});var n=r(40742);async function a(e,t){const r=await(0,n.T)(e,t);r.layers=r.layers.filter(o);const a={serviceJSON:r};if((r.currentVersion??0)<10.5)return a;const l=await(0,n.T)(e+"/layers",t);return a.layersJSON={layers:l.layers.filter(o),tables:l.tables},a}function o(e){return!e.type||"Feature Layer"===e.type}},52395:function(e,t,r){r.d(t,{Y:function(){return l},h:function(){return o}});var n=r(99659),a=r(53262);function o(e){return{origin:"portal-item",url:(0,n.mN)(e.itemUrl),portal:e.portal||a.Z.getDefault(),portalItem:e,readResourcePaths:[]}}function l(e){return{origin:"portal-item",messages:[],writtenProperties:[],url:e.itemUrl?(0,n.mN)(e.itemUrl):null,portal:e.portal||a.Z.getDefault(),portalItem:e}}},20111:function(e,t,r){r.r(t),r.d(t,{getFirstLayerOrTableId:function(){return L},getNumLayersAndTables:function(){return F},getSubtypeGroupLayerIds:function(){return N},load:function(){return f},preprocessFSItemData:function(){return v}});r(57658);var n=r(22130),a=r(36421),o=r(53317),l=r(49093),i=r(53262),u=r(999),s=r(52395),c=r(52468),y=r(78508),p=r(40742);async function f(e,t){const r=e.instance.portalItem;if(r&&r.id)return await r.load(t),d(e),m(e,t)}function d(e){const t=e.instance.portalItem;if(!t?.type||!e.supportedTypes.includes(t.type))throw new n.Z("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}'",{type:t?.type,expectedType:e.supportedTypes.join(", ")})}async function m(e,t){const r=e.instance,n=r.portalItem;if(!n)return;const{url:a,title:o}=n,l=(0,s.h)(n);if("group"===r.type)return r.read({title:o},l),b(r,e);a&&r.read({url:a},l);const i=await T(e,t);return i&&r.read(i,l),r.resourceReferences={portalItem:n,paths:l.readResourcePaths??[]},"subtype-group"!==r.type&&r.read({title:o},l),(0,y.y)(r,l)}async function b(e,t){let r;const{portalItem:a}=e;if(!a)return;const o=a.type,l=t.layerModuleTypeMap,i=(0,c._$)(a,"Oriented Imagery Layer")??!1;switch(o){case"Feature Service":r=i?l.OrientedImageryLayer:l.FeatureLayer;break;case"Stream Service":r=l.StreamLayer;break;case"Scene Service":r=l.SceneLayer;break;case"Feature Collection":r=l.FeatureLayer;break;default:throw new n.Z("portal:unsupported-item-type-as-group",`The item type '${o}' is not supported as a 'IGroupLayer'`)}let[u,s]=await Promise.all([r(),T(t)]),y=()=>u;if("Feature Service"===o){if(s=a.url?await v(s,a.url):{},N(s).length){const e=l.SubtypeGroupLayer,t=await e();y=e=>"SubtypeGroupLayer"===e.layerType?t:u}return w(e,y,s,await Z(a.url))}return F(s)>0?w(e,y,s):g(e,y)}async function g(e,t){const{portalItem:r}=e;if(!r?.url)return;const n=await(0,p.T)(r.url);n&&w(e,t,{layers:n.layers?.map(h),tables:n.tables?.map(h)})}function h(e){return{id:e.id,name:e.name}}function w(e,t,r,n){let a=r.layers||[];const o=r.tables||[];if("Feature Collection"===e.portalItem?.type&&(a.forEach((e=>{"Table"===e?.layerDefinition?.type&&o.push(e)})),a=a.filter((e=>"Table"!==e?.layerDefinition?.type))),"coverage"in r){const t=D(r);t&&e.add(t)}a.reverse().forEach((a=>{const o=I(e,t(a),r,a,n?.(a));e.add(o)})),o.reverse().forEach((a=>{const o=I(e,t(a),r,a,n?.(a));e.tables.add(o)}))}function I(e,t,r,n,a){const o=e.portalItem,l=new t({portalItem:o.clone(),layerId:n.id});if("sourceJSON"in l&&(l.sourceJSON=a),"subtype-group"!==l.type&&(l.sublayerTitleMode="service-name"),"Feature Collection"===o.type){const e={origin:"portal-item",portal:o.portal||i.Z.getDefault()};l.read(n,e);const t=r.showLegend;null!=t&&l.read({showLegend:t},e)}return l}async function T(e,t){if(!1===e.supportsData)return;const r=e.instance,n=r.portalItem;if(!n)return;let a=null;try{a=await n.fetchData("json",t)}catch(o){}if(k(r)){let e=null,t=!0;if(a&&F(a)>0){if(null==r.layerId){const e=N(a);r.layerId="subtype-group"===r.type?e?.[0]:L(a)}e=S(a,r),e&&(1===F(a)&&(t=!1),null!=a.showLegend&&(e.showLegend=a.showLegend))}return t&&"service-name"!==r.sublayerTitleMode&&(r.sublayerTitleMode="item-title-and-service-name"),e}return a}async function v(e,t){if(null==e?.layers||null==e?.tables){const r=await(0,p.T)(t);(e=e||{}).layers=e.layers||r?.layers,e.tables=e.tables||r?.tables}return e}function L(e){const t=e.layers;if(t&&t.length)return t[0].id;const r=e.tables;return r&&r.length?r[0].id:null}function S(e,t){const{layerId:r}=t,n=e.layers?.find((e=>e.id===r))||e.tables?.find((e=>e.id===r));return n&&O(n,t)?n:null}function F(e){return(e?.layers?.length??0)+(e?.tables?.length??0)}function k(e){return"stream"!==e.type&&"oriented-imagery"!==e.type&&"layerId"in e}function D(e){const{coverage:t}=e;if(!t)return null;const r=new URL(t);if(t.toLowerCase().includes("item.html")){const e=r.searchParams.get("id"),t=r.origin;return a.Z.fromPortalItem({portalItem:new u["default"]({id:e,url:t})})}if((0,o.B5)(t))return a.Z.fromArcGISServerUrl({url:t});throw new n.Z("portal:oriented-imagery-layer-coverage","the provided coverage url couldn't be loaded as a layer")}function N(e){const t=[];return e?.layers?.forEach((e=>{"SubtypeGroupLayer"===e.layerType&&t.push(e.id)})),t}function O(e,t){return!("feature"===t.type&&"layerType"in e&&"SubtypeGroupLayer"===e.layerType||"subtype-group"===t.type&&!("layerType"in e))}async function Z(e){const{layersJSON:t}=await(0,l.V)(e);if(!t)return null;const r=[...t.layers,...t.tables];return e=>r.find((t=>t.id===e.id))}},40742:function(e,t,r){r.d(t,{T:function(){return a}});var n=r(94848);async function a(e,t){const{data:r}=await(0,n["default"])(e,{responseType:"json",query:{f:"json",...t?.customParameters,token:t?.apiKey}});return r}}}]);